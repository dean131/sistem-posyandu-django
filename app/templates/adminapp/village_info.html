{% extends 'base.html' %}
{% block subheader %}
<div class="subheader py-2 py-lg-4 subheader-solid" id="kt_subheader">
    <div class="container-fluid d-flex align-items-center justify-content-between flex-wrap flex-sm-nowrap">
        <!--begin::Info-->
        <div class="d-flex align-items-center flex-wrap mr-2">
            <!--begin::Page Title-->
            <h5 class="text-dark font-weight-bold mt-2 mb-2 mr-5">Informasi Desa</h5>
            <!--end::Page Title-->
        </div>
        <!--end::Info-->
    </div>
</div>
{% endblock %}
{% block content %}
<!--begin::Card-->
<div class="card card-custom gutter-b">
    <!--begin::Card Body-->
    <div class="card-body">
        <!--begin::Details-->
        <div class="d-flex">
            <!--begin: Pic-->
            {% if village.logo %}
            <div class="flex-shrink-0 mr-7 mt-lg-0 mt-3">
                <div class="symbol symbol-70 symbol-lg-100">
                    <img src="{{ village.logo.url }}" alt="image" />
                </div>
                <div class="symbol symbol-70 symbol-lg-100 symbol-primary d-none">
                    <span class="font-size-h3 symbol-label font-weight-boldest">Logo</span>
                </div>
            </div>
            {% else %}
            <div class="symbol symbol-light-success symbol-50 symbol-lg-70 mr-3">
                <span class="symbol-label font-size-h2">{{ village.name.0 }}</span>
            </div>
            {% endif %}
            <!--end::Pic-->
            <!--begin::Info-->
            <div class="flex-grow-1 d-flex align-items-center">
                <!--begin::Title-->
                <div class="d-flex justify-content-between flex-wrap">
                    <div class="d-flex mr-3">
                        <a href="#" class="text-dark-75 text-hover-primary font-size-h2 font-weight-bolder mr-3">
                            {{ village.name }}
                        </a>
                    </div>
                </div>
                <!--end::Title-->
                <!--begin::Content-->
                <!-- <div class="d-flex flex-wrap justify-content-between mt-1">
                        <div class="d-flex flex-column flex-grow-1 pr-8">
                            <div class="d-flex flex-wrap mb-4">
                                <a href="#"
                                    class="text-dark-50 text-hover-primary font-weight-bold mr-lg-8 mr-5 mb-lg-0 mb-2">
                                    <i class="flaticon2-new-email mr-2 font-size-lg"></i>
                                    {{ village.email }}
                                </a>
                                <a href="#"
                                    class="text-dark-50 text-hover-primary font-weight-bold mr-lg-8 mr-5 mb-lg-0 mb-2">
                                    <i class="flaticon2-calendar-3 mr-2 font-size-lg"></i>
                                    Desa
                                </a>
                                <a href="#" class="text-dark-50 text-hover-primary font-weight-bold">
                                    <i class="flaticon2-placeholder mr-2 font-size-lg"></i>
                                    {{ village.address.address }}
                                </a>
                            </div>
                        </div>
                    </div> -->
                <!--end::Content-->
            </div>
            <!--end::Info-->
        </div>

    </div>
    <!--end::Card Body-->
</div>
<!--end::Card-->
<!--begin::Advance Table Widget 8-->
<div class="card card-custom gutter-b">
    <!--begin::Header-->
    <div class="card-header border-0 py-5">
        <h3 class="card-title align-items-start flex-column">
            <span class="card-label font-weight-bolder text-dark">Penugasan</span>
            <span class="text-muted mt-3 font-weight-bold font-size-sm">
                Informasi siapa saja Bidan yang ditugaskan di Desa ini
            </span>
        </h3>
        <!-- <div class="card-toolbar">
                <a href="#" class="btn btn-info font-weight-bolder font-size-sm mr-3">New Report</a>
                <a href="#" class="btn btn-danger font-weight-bolder font-size-sm">Create</a>
            </div> -->
    </div>
    <!--end::Header-->
    <!--begin::Body-->
    <div class="card-body pt-0 pb-3">
        <!--begin::Table-->
        <div class="table-responsive">
            <table class="table table-head-custom table-head-bg table-vertical-center table-borderless">
                <thead>
                    <tr class="bg-gray-100 text-left">
                        <th hidden>PK</th>
                        <th>
                            <span class="text-dark-75">No</span>
                        </th>
                        <th class="pl-7">
                            <span class="text-dark-75">Nama Bidan</span>
                        </th>
                        <th>
                            <span class="text-dark-75">Aksi</span>
                        </th>
                        <th hidden>Midwife ID</th>
                    </tr>
                </thead>
                <tbody>
                    {% for midwifeassisgnment in village.midwifeassignment_set.all %}
                    <tr>
                        <td hidden>
                            {{ midwifeassisgnment.id}}
                        </td>
                        <td>
                            <span class="text-dark-75 font-weight-bolder d-block font-size-lg">
                                {{ forloop.counter }}
                            </span>
                        </td>
                        <td>
                            <a href="{% url 'midwife_info' midwifeassisgnment.midwife.id  %}"
                                class="text-dark-75 text-hover-primary font-size-h5 font-weight-bold">
                                {{ midwifeassisgnment.midwife.full_name }}
                            </a>
                        </td>
                        <td class="pr-0 text-center">
                            <button class="btn btn-icon btn-light btn-hover-danger btn-sm delete-assignment-button"
                                data-toggle="modal" data-target="#deleteModal">
                                <span class="svg-icon svg-icon-md svg-icon-danger">
                                    <!--begin::Svg Icon | path:assets/media/svg/icons/General/Trash.svg-->
                                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                                        width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                            <rect x="0" y="0" width="24" height="24" />
                                            <path
                                                d="M6,8 L6,20.5 C6,21.3284271 6.67157288,22 7.5,22 L16.5,22 C17.3284271,22 18,21.3284271 18,20.5 L18,8 L6,8 Z"
                                                fill="#000000" fill-rule="nonzero" />
                                            <path
                                                d="M14,4.5 L14,4 C14,3.44771525 13.5522847,3 13,3 L11,3 C10.4477153,3 10,3.44771525 10,4 L10,4.5 L5.5,4.5 C5.22385763,4.5 5,4.72385763 5,5 L5,5.5 C5,5.77614237 5.22385763,6 5.5,6 L18.5,6 C18.7761424,6 19,5.77614237 19,5.5 L19,5 C19,4.72385763 18.7761424,4.5 18.5,4.5 L14,4.5 Z"
                                                fill="#000000" opacity="0.3" />
                                        </g>
                                    </svg>
                                    <!--end::Svg Icon-->
                                </span>
                            </button>
                        </td>
                        <td hidden>
                            {{ midwifeassisgnment.midwife.id }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <!--end::Table-->
    </div>
    <!--end::Body-->
</div>
<!--end::Advance Table Widget 8-->

{% include 'adminapp/modals/delete_modal.html' %}
{% endblock %}

{% block js_page %}
<script>
    const csrf_token = '{{ csrf_token }}'

    $(document).ready(function () {
        $('.delete-assignment-button').click(function () {
            const midwifeId = $(this).closest('tr').find('td').eq(4).text().trim();
            $('#deleteForm').attr('action', '{% url "midwife_assignments" %}');
            $('#deleteForm').append(`<input type="hidden" name="midwife-id" value="${midwifeId}">`);
            $('input[name="pk"]').val($(this).closest('tr').find('td').eq(0).text().trim());
        });
    });
</script>
{% endblock %}